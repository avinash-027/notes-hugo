{{ define "main" }}
{{ if .Content }}

  <div class="index-content {{ if .Params.framed -}}framed{{- end -}}">
    {{ .Content }}
  </div>

{{ else if site.Params.terminalProfile.show }}
  <style>
    .terminal-index-profile { display: flex; flex-wrap: wrap; gap: 2rem; align-items: center;}

    .terminal-index-profile .terminal-index-left { flex: 0 0 auto;}
    .terminal-index-profile .terminal-index-left img { max-width: 200px; display: block;}

    .terminal-index-profile .terminal-index-right { flex: 1; min-width: 260px; }
    .terminal-index-profile .terminal-index-right h2 { margin-top: 0; }
    .terminal-index-profile .terminal-index-right a { text-decoration: none; }
    .terminal-index-profile .terminal-index-right a:hover { text-decoration: underline;}
    .terminal-index-profile .terminal-index-right h2,.terminal-index-profile .terminal-index-right p { margin: 10px 0;}

    .social-links { margin-top: 0.8rem; }
    .social-links a { margin-right: 1rem; display: inline-block;}

    @media (max-width: 600px) {
      .terminal-index-profile { flex-direction: column; align-items: flex-start;}
      .terminal-index-profile .terminal-index-left img { max-width: 160px; }
    }
  </style>
  <div class="index-content framed terminal-index-profile">
    <div class="terminal-index-left">
      {{ with site.Params.terminalProfile.imageUrl }}
        <img src="{{ . | relURL }}" alt="profile image">
      {{ end }}
    </div>
    <div class="terminal-index-right">
      <h2>{{ site.Title }}</h2>
      {{ with site.Params.terminalProfile.username }}
        <p><strong>User:</strong> {{ . }}</p>
      {{ end }}
      {{ with site.Params.terminalProfile.message }}
        <p>{{ . }}</p>
      {{ end }}
      {{ with site.Params.terminalProfile.social }}
        <div class="social-links">
          {{ range . }}
            <a href="{{ .url }}" target="_blank">{{ .name }}</a>
          {{ end }}
        </div>
      {{ end }}
    </div>
  </div>
{{ end }}

  <div class="posts">
    {{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
    {{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}

    {{ $PageContext := . }}
    {{ if .IsHome }}
      {{ $PageContext = .Site }}
    {{ end }}
    {{ $paginator := .Paginate (where $PageContext.RegularPages "Type" $contentTypeName) }}

    {{ range $paginator.Pages }}
      <article class="post on-list">
        <h2 class="post-title">
          <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a>
        </h2>

        <div class="post-meta">
          {{- if .Date -}}
            <time class="post-date">
              {{- partial "post-date" . -}}
            </time>
          {{- end -}}
          {{- with .Params.Author -}}
            <span class="post-author">{{ . }}</span>
          {{- end -}}
        </div>

        {{ if .Params.tags }}
          <span class="post-tags">
            {{ range .Params.tags }}
            #<a href="{{ (urlize (printf "tags/%s/" . )) | absLangURL }}">
              {{- . -}}
            </a>&nbsp;
            {{ end }}
          </span>
        {{ end }}

        {{ partial "cover.html" . }}

        <div class="post-content">
          {{ if .Params.showFullContent }}
            {{ .Content }}
          {{ else if .Description }}
            <p>{{ .Description | markdownify }}</p>
          {{ else }}
            {{ .Summary }}
          {{ end }}
        </div>

        {{ if not .Params.showFullContent }}
          <div>
            <a class="read-more button inline" href="{{ .RelPermalink }}">[{{ $.Site.Params.ReadMore }}]</a>
          </div>
        {{ end }}
      </article>
    {{ end }}

    {{ partial "pagination.html" . }}
  </div>
{{ end }}
